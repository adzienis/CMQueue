<% options = {} if local_assigns[:options].nil? %>
<% options[:extra_columns] ||= [] %>
<% options[:except] ||= [] %>
<% options[:actions] ||= [] %>

<%= content_tag :div, id: "dropdown-filter", data: {
  colNames: records.model.column_names, queries: params[:q]
}.to_json do %>
<% end %>

<h3>
  Results
</h3>

<% if !records.empty? %>
  <div class="table-responsive mb-3" id="results">
    <table class="table table-hover table-striped">
      <thead>
      <tr>
        <th>
          Actions
        </th>
        <% options[:extra_columns].each do |extra| %>
          <th style="min-width: 125px">
            <%= sort_link(ransack, extra.flatten.join('_')) do %>
              <%= "#{extra.flatten[-2].to_s.humanize} #{extra.flatten[-1].to_s.humanize}" %>
            <% end %>
          </th>
        <% end %>
        <% records.model.column_names.reject { |c| options[:except].include? c.to_sym }.each do |k| %>
          <th style="min-width: 125px">
            <%= sort_link(ransack, k.to_sym) %>
          </th>
        <% end %>
      </tr>
      </thead>
      <tbody>
      <% records&.each do |tag| %>
        <tr>
          <td>
            <%= link_to edit_polymorphic_url([course || tag.course, tag]) do %>
              <i class="fas fa-edit"></i>
            <% end if options[:actions].include? :edit %>
            <%= link_to url_for([course, tag]) do %>
              <i class="fas fa-info-circle"></i>
            <% end%>
          </td>
          <% options[:extra_columns].each do |extra| %>
            <td>
              <%= ApplicationHelper::SearchClass.fetch_attribute(tag, extra) %>
            </td>
          <% end %>
          <% records.model.column_names.reject { |c| options[:except].include? c.to_sym }.each do |k| %>
            <td>
              <div style="  display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden">
                <% if records.model.column_for_attribute(k).type.to_s == "datetime" %>
                  <%= tag.try(k.to_sym).localtime.to_formatted_s(:short) %>
                <% else %>
                  <%= tag.send(k.to_sym) %>
                <% end %>
              </div>
            </td>
          <% end %>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
  <div>
    <%= "#{pagy.count} #{records.model.name.pluralize}" %>
  </div>
<% else %>
  <div class="alert alert-warning shadow-sm">
    Empty
  </div>
  <%= "#{pagy.count} #{records.model.name.pluralize}" %>
<% end %>


<div class="w-100 d-flex justify-content-center">
  <%== render partial: "pagy/nav.html.erb", locals: { pagy: pagy } %>
</div>